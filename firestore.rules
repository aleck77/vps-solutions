rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Существующие правила для постов
    match /posts/{postId} {
      // Любой может читать опубликованные посты
      allow read: if resource.data.published == true;
      // Только администраторы могут создавать, обновлять или удалять посты
      allow write: if request.auth.token.admin == true;
    }
    
    // Существующие правила для категорий
    match /categories/{categoryId} {
      // Любой может читать список категорий
      allow read: if true;
      // Только администраторы могут изменять категории
      allow write: if request.auth.token.admin == true;
    }

    // Существующие правила для подписчиков
    match /subscribers/{subscriberId} {
        // Никто не может читать чужие email-адреса
        allow read: if false;
        // Любой может создать новую подписку (добавить свой email)
        allow create: if true;
        // Никто не может изменять или удалять подписки
        allow update, delete: if false;
    }

    // --- НОВОЕ ПРАВИЛО ДЛЯ СТРАНИЦ ---
    // Любой может читать содержимое страниц (About, Contact и т.д.)
    match /pages/{pageId} {
      allow read: if true;
      // Только администраторы могут создавать или изменять страницы
      allow write: if request.auth.token.admin == true;
    }
    
    // ===== Navigation =====
    // Любой пользователь может читать меню навигации.
    // Только администраторы могут изменять меню.
    match /navigation/{navId} {
        allow read: if true;
        allow write: if request.auth.token.admin == true;
    }

    // --- НОВОЕ ПРАВИЛО ДЛЯ ТАРИФОВ VPS ---
    match /vps_plans/{planId} {
      // Любой может читать список тарифов
      allow read: if true;
      // Только администраторы могут изменять тарифы
      allow write: if request.auth.token.admin == true;
    }
  }
}
